# –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π Makefile —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CC = gcc
CFLAGS = -Wall -Wextra

.PHONY: all run test clear help

all: main send
	@echo "===================================="
	@echo "‚úÖ –ü—Ä–æ–≥—Ä–∞–º–º—ã —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã:"
	@echo "- main (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ SIGINT)"
	@echo "- send (–æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤)"
	@echo "===================================="
	@echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
	@echo "make run  - –∑–∞–ø—É—Å–∫ main"
	@echo "make test - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∏–≥–Ω–∞–ª"
	@echo "make clear - —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã"

main: main.c
	@echo "üîß –ö–æ–º–ø–∏–ª—è—Ü–∏—è main..."
	$(CC) $(CFLAGS) $< -o $@

send: send.c
	@echo "üîß –ö–æ–º–ø–∏–ª—è—Ü–∏—è send..."
	$(CC) $(CFLAGS) $< -o $@

run: main
	@echo "üöÄ –ó–∞–ø—É—Å–∫ main –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ..."
	./main & echo $$! > pid.txt
	@echo "üîÑ PID —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ pid.txt: $$(cat pid.txt)"
	@echo "‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 'make test' –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–∏–≥–Ω–∞–ª–∞"

test: send
	@if [ -f pid.txt ]; then \
		echo "üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ –Ω–∞ PID $$(cat pid.txt)..."; \
		./send $$(cat pid.txt); \
	else \
		echo "‚ùå –û—à–∏–±–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ 'make run'"; \
		exit 1; \
	fi

clear:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞..."
	rm -f main send pid.txt
	@echo "‚úÖ –í—Å–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã"

help:
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "make all   - —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)"
	@echo "make run   - –∑–∞–ø—É—Å—Ç–∏—Ç—å main"
	@echo "make test  - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∏–≥–Ω–∞–ª"
	@echo "make clear - —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã"
	@echo "make help  - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É"
